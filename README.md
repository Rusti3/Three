# Three.js Train Demo

Сайт на `three.js`, где поезд автоматически едет по рельсам в 3D-сцене.

## Run

```bash
npm install
npm run dev
```

## Test

```bash
npm run test
```

## Version Summary

### v0.2.0 (2026-02-23)

Что сделано:
- Полностью удалена логика машины и клавиатурного управления.
- Добавлены новые модели сцены:
  - `the_polar_express_locomotive.glb` (поезд),
  - `railway.glb` (рельсы).
- Реализована автоподгонка моделей через `Box3` (масштаб, центрирование, позиционирование, тени).
- Добавлен модуль движения `trainMotion`: поезд едет только вперед по оси `Z` и циклически возвращается в начало пути.
- Обновлен рендер-сценарий: follow-camera теперь следует за поездом.
- Переписаны тесты:
  - unit для движения поезда и подготовки моделей (`trainMotion`, `trainModel`, `railModel`),
  - e2e smoke на автозагрузку моделей и автоматическое движение без клавиатуры.
- Удалены устаревшие файлы машины (`controls`, `vehicle`, `carModel`, `carPlaceholder` и их тесты).

Зачем эти функции:
- Проект теперь соответствует новому сценарию: «поезд по рельсам без ручного управления».
- Автоподгонка `Box3` уменьшает ручные правки трансформаций для новых моделей.
- Упрощенная логика движения делает поведение предсказуемым и стабильным.

Что изменилось для пользователя:
- Больше нет управления машиной.
- На сцене загружаются рельсы и локомотив.
- Поезд автоматически едет вперед по рельсам и зацикливается.

### v0.1.2 (2026-02-22)

Что сделано:
- Исправлено направление поворота: `D` теперь поворачивает вправо, `A` — влево.
- Увеличен масштаб модели машины `sample.glb` в 20 раз (с текущего коэффициента).
- Обновлены тесты под новое поведение управления и масштаб модели.

Зачем эти функции:
- Направление поворота теперь соответствует ожидаемому управлению.
- Модель стала заметно крупнее и лучше читается в сцене.

Что изменилось для пользователя:
- Нажатие `D` поворачивает машину вправо.
- Машина отображается значительно больше.

### v0.1.1 (2026-02-22)

Что сделано:
- Подключена реальная модель машины `sample.glb` через `GLTFLoader`.
- Добавлен модуль `src/game/carModel.ts` для загрузки и базовой подготовки модели (масштаб, смещение, тени).
- В `src/main.ts` заменена постоянная заглушка: теперь сначала пытаемся загрузить `sample.glb`, а заглушка остается как fallback при ошибке загрузки.
- Расширен debug API в `window.__THREE_DRIVE__` флагом `isCarModelLoaded`.
- Добавлены тесты под новую функциональность:
  - `src/game/carModel.test.ts` (unit для URL и подготовки модели),
  - e2e smoke дополнен проверкой фактической загрузки GLB.

Зачем эти функции:
- Пользователь теперь видит реальную 3D-модель машины, а не примитив.
- Отдельный модуль загрузки упрощает будущую замену/настройку модели.
- Fallback сохраняет работоспособность сцены при проблемах с ассетом.

Что изменилось для пользователя:
- Визуально машина стала реальной моделью из `sample.glb`.
- Управление и поведение движения остались прежними (`W/A/S/D`, `R`).

### v0.1.0 (2026-02-22)

Что сделано:
- Поднят проект на `Vite + TypeScript + Three.js`.
- Добавлена 3D-сцена: свет, земля, сетка и камера, которая следует за машиной.
- Реализована аркадная езда на `W/A/S/D` и стрелках.
- Добавлен `R` для сброса позиции/угла/скорости.
- Временная модель машины сделана как 3D-заглушка (группа мешей), готовая к замене на `GLB/GLTF`.
- Добавлены автотесты:
  - unit (`Vitest`) для логики движения и клавиатурных контролов;
  - e2e smoke (`Playwright`) для проверки рендера и движения в браузере.

Зачем эти функции:
- Разделение на модули `controls`, `vehicle`, `followCamera` упрощает развитие и замену модели без переписывания геймплея.
- Тесты снижают риск поломок при доработках.

Что изменилось для пользователя:
- Пользователь открывает страницу и сразу может ездить на машине по сцене с follow-камерой.
- Есть понятный HUD с подсказкой управления.
